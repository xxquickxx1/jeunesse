var image_added;!function(t){var a,e,i,r,d,o;t(document).ready(function(){var e=t("#page_image_picker");o=e.data("input-type"),d="wym"==o,t("#custom_images_tab a").click(function(){if(!e.data("size-applied")&&d){var a=t(".page_part:first .wym_box"),i=t(".page_part:first iframe");e.css({height:a.height(),width:a.width()}).data("size-applied",!0).corner("tr 5px").corner("bottom 5px").find(".wym_box").css({backgroundColor:"white",height:i.height()+t(".page_part:first .wym_area_top").height()-parseInt(t(".wym_area_top .label_inline_with_link a").css("lineHeight")),width:i.width()-20,"border-color":i.css("border-top-color"),"border-style":i.css("border-top-style"),"border-width":i.css("border-top-width"),padding:"0px 10px 0px 10px"})}}),t("#page_images li textarea:hidden").each(function(a){var e=t(this).attr("name"),i=t(this);i.attr("data-old-id",i.attr("id")),i.attr("name","ignore_me_"+a),i.attr("id","ignore_me_"+a);var r=t("<input>").addClass("caption").attr("type","hidden").attr("name",e).attr("id",i.attr("data-old-id")).val(i.val());i.parents("li").first().append(r)}),a(),t(".page-images-caption-modal").hide(),r=t("#page_images .js-page-images-template").detach()}),a=function(){d&&WYMeditor.onload_functions.push(function(){t(".wym_box").css({width:null})}),t("#page_images").sortable({tolerance:"pointer",placeholder:"placeholder",cursor:"drag",items:"li",stop:i}),t("#page_images").on("mouseenter mouseleave","li",function(a){var r=t(this),d=r.find(".image_actions");if("mouseenter"==a.type){if(0==d.length){d=t("<div class='image_actions'></div>");var o=t("<img src='/assets/refinery/icons/delete-6fab9310cb7ca270fca3eb99395659c9fa4d673cec260aecd2c964ba7e4bcc68.png' width='16' height='16' />");if(o.appendTo(d),o.click(function(){t(this).parents("li").first().remove(),i()}),r.find("textarea.page_caption").length>0){var n=t("<img src='/assets/refinery/icons/user_comment-b812ae9617c513096bfc9687c586d3ef9946cc83cfb4585cf8789785c1b16722.png' width='16' height='16' class='caption' />");n.appendTo(d),n.click(e)}else d.addClass("no_captions");d.appendTo(r)}d.show()}else"mouseleave"==a.type&&d.hide()}),i()},image_added=function(e){var i=r.clone(),d=t(e).attr("id").replace("image_","");i.find("input:hidden:first").val(d),t("<img />").attr({title:t(e).attr("title"),alt:t(e).attr("alt"),src:t(e).attr("data-grid")}).appendTo(i),i.attr("id","image_"+d).removeClass("empty"),i.appendTo(t("#page_images")),a()},e=function(){var a=t(this).closest("li"),e=a.find(".page-images-caption-modal > textarea"),i=e.parent(),r={textarea:{width:400,height:"auto"},wym:{width:928,height:530}};i.find(".js-page-images-done").on("click",function(){i.dialog("close")});var n=function(){d&&e.data("wymeditor").update(),t("li.current_caption_list_item").removeClass("current_caption_list_item"),t("#"+e.attr("data-old-id")).val(e.val()),i.dialog("destroy")};a.addClass("current_caption_list_item"),i.dialog({title:"Add Caption",modal:!0,resizable:!1,autoOpen:!0,width:r[o].width,height:r[o].height,close:n}),d?e.addClass("wymeditor active_rotator_wymeditor widest").wymeditor(wymeditor_boot_options):e.show()},i=function(){t("#page_images li textarea:hidden").each(function(a,e){var i=t(e).attr("name").split("_");i[2]=""+a,t(e).attr("name",i.join("_")),t(e).attr("id",t(e).attr("id").replace(/_\d/,"_"+a)),t(e).attr("data-old-id",t(e).attr("data-old-id").replace(/_\d_/,"_"+a+"_").replace(/_\d/,"_"+a))}),t("#page_images li").each(function(a,e){t("input:hidden",e).each(function(){var e=t(this),i=e.attr("name").split("]");i[1]="["+a,e.attr("name",i.join("]")),e.attr("id",e.attr("id").replace(/_\d_/,"_"+a+"_").replace(/_\d/,"_"+a))})})}}(jQuery);